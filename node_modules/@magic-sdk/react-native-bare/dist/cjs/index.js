"use strict";var _e=Object.create;var N=Object.defineProperty,Oe=Object.defineProperties,Re=Object.getOwnPropertyDescriptor,Me=Object.getOwnPropertyDescriptors,Ve=Object.getOwnPropertyNames,ie=Object.getOwnPropertySymbols,Ae=Object.getPrototypeOf,se=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable;var ae=(n,a,i)=>a in n?N(n,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):n[a]=i,ce=(n,a)=>{for(var i in a||(a={}))se.call(a,i)&&ae(n,i,a[i]);if(ie)for(var i of ie(a))Ne.call(a,i)&&ae(n,i,a[i]);return n},le=(n,a)=>Oe(n,Me(a));var Ge=(n,a)=>()=>(a||n((a={exports:{}}).exports,a),a.exports),Ie=(n,a)=>{for(var i in a)N(n,i,{get:a[i],enumerable:!0})},T=(n,a,i,p)=>{if(a&&typeof a=="object"||typeof a=="function")for(let c of Ve(a))!se.call(n,c)&&c!==i&&N(n,c,{get:()=>a[c],enumerable:!(p=Re(a,c))||p.enumerable});return n},f=(n,a,i)=>(T(n,a,"default"),i&&T(i,a,"default")),V=(n,a,i)=>(i=n!=null?_e(Ae(n)):{},T(a||!n||!n.__esModule?N(i,"default",{value:n,enumerable:!0}):i,n)),Pe=n=>T(N({},"__esModule",{value:!0}),n);var C=(n,a,i)=>new Promise((p,c)=>{var L=g=>{try{_(i.next(g))}catch(v){c(v)}},h=g=>{try{_(i.throw(g))}catch(v){c(v)}},_=g=>g.done?p(g.value):Promise.resolve(g.value).then(L,h);_((i=i.apply(n,a)).next())});var ue=Ge((je,Z)=>{var X=function(n){"use strict";var a=Object.prototype,i=a.hasOwnProperty,p=Object.defineProperty||function(t,e,r){t[e]=r.value},c,L=typeof Symbol=="function"?Symbol:{},h=L.iterator||"@@iterator",_=L.asyncIterator||"@@asyncIterator",g=L.toStringTag||"@@toStringTag";function v(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{v({},"")}catch{v=function(e,r,s){return e[r]=s}}function S(t,e,r,s){var o=e&&e.prototype instanceof q?e:q,l=Object.create(o.prototype),m=new H(s||[]);return p(l,"_invoke",{value:Ee(t,r,m)}),l}n.wrap=S;function G(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(s){return{type:"throw",arg:s}}}var K="suspendedStart",Se="suspendedYield",te="executing",I="completed",E={};function q(){}function P(){}function O(){}var z={};v(z,h,function(){return this});var F=Object.getPrototypeOf,k=F&&F(F(x([])));k&&k!==a&&i.call(k,h)&&(z=k);var M=O.prototype=q.prototype=Object.create(z);P.prototype=O,p(M,"constructor",{value:O,configurable:!0}),p(O,"constructor",{value:P,configurable:!0}),P.displayName=v(O,g,"GeneratorFunction");function re(t){["next","throw","return"].forEach(function(e){v(t,e,function(r){return this._invoke(e,r)})})}n.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===P||(e.displayName||e.name)==="GeneratorFunction":!1},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,O):(t.__proto__=O,v(t,g,"GeneratorFunction")),t.prototype=Object.create(M),t},n.awrap=function(t){return{__await:t}};function D(t,e){function r(l,m,d,b){var y=G(t[l],t,m);if(y.type==="throw")b(y.arg);else{var Q=y.arg,A=Q.value;return A&&typeof A=="object"&&i.call(A,"__await")?e.resolve(A.__await).then(function(R){r("next",R,d,b)},function(R){r("throw",R,d,b)}):e.resolve(A).then(function(R){Q.value=R,d(Q)},function(R){return r("throw",R,d,b)})}}var s;function o(l,m){function d(){return new e(function(b,y){r(l,m,b,y)})}return s=s?s.then(d,d):d()}p(this,"_invoke",{value:o})}re(D.prototype),v(D.prototype,_,function(){return this}),n.AsyncIterator=D,n.async=function(t,e,r,s,o){o===void 0&&(o=Promise);var l=new D(S(t,e,r,s),o);return n.isGeneratorFunction(e)?l:l.next().then(function(m){return m.done?m.value:l.next()})};function Ee(t,e,r){var s=K;return function(l,m){if(s===te)throw new Error("Generator is already running");if(s===I){if(l==="throw")throw m;return oe()}for(r.method=l,r.arg=m;;){var d=r.delegate;if(d){var b=ne(d,r);if(b){if(b===E)continue;return b}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(s===K)throw s=I,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);s=te;var y=G(t,e,r);if(y.type==="normal"){if(s=r.done?I:Se,y.arg===E)continue;return{value:y.arg,done:r.done}}else y.type==="throw"&&(s=I,r.method="throw",r.arg=y.arg)}}}function ne(t,e){var r=e.method,s=t.iterator[r];if(s===c)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=c,ne(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),E;var o=G(s,t.iterator,e.arg);if(o.type==="throw")return e.method="throw",e.arg=o.arg,e.delegate=null,E;var l=o.arg;if(!l)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,E;if(l.done)e[t.resultName]=l.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=c);else return l;return e.delegate=null,E}re(M),v(M,g,"Generator"),v(M,h,function(){return this}),v(M,"toString",function(){return"[object Generator]"});function Le(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function J(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function H(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(Le,this),this.reset(!0)}n.keys=function(t){var e=Object(t),r=[];for(var s in e)r.push(s);return r.reverse(),function o(){for(;r.length;){var l=r.pop();if(l in e)return o.value=l,o.done=!1,o}return o.done=!0,o}};function x(t){if(t){var e=t[h];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,s=function o(){for(;++r<t.length;)if(i.call(t,r))return o.value=t[r],o.done=!1,o;return o.value=c,o.done=!0,o};return s.next=s}}return{next:oe}}n.values=x;function oe(){return{value:c,done:!0}}return H.prototype={constructor:H,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(J),!t)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(b,y){return l.type="throw",l.arg=t,e.next=b,y&&(e.method="next",e.arg=c),!!y}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],l=o.completion;if(o.tryLoc==="root")return r("end");if(o.tryLoc<=this.prev){var m=i.call(o,"catchLoc"),d=i.call(o,"finallyLoc");if(m&&d){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(m){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else if(d){if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r];if(s.tryLoc<=this.prev&&i.call(s,"finallyLoc")&&this.prev<s.finallyLoc){var o=s;break}}o&&(t==="break"||t==="continue")&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var l=o?o.completion:{};return l.type=t,l.arg=e,o?(this.method="next",this.next=o.finallyLoc,E):this.complete(l)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),E},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),J(r),E}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var s=r.completion;if(s.type==="throw"){var o=s.arg;J(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:x(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=c),E}},n}(typeof Z=="object"?Z.exports:{});try{regeneratorRuntime=X}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=X:Function("r","regeneratorRuntime = r")(X)}});var u={};Ie(u,{Magic:()=>Ce});module.exports=Pe(u);var $e=V(ue()),de=require("@magic-sdk/provider"),Te=V(require("process")),ye=V(require("localforage")),Y=require("whatwg-url"),$=require("buffer"),ge=V(require("lodash")),we=require("react-native-device-info"),be=require("@aveq-research/localforage-asyncstorage-driver"),ee=V(require("localforage-driver-memory"));var w=V(require("react")),j=require("react-native"),he=require("react-native-webview"),pe=require("react-native-safe-area-context"),B=require("@magic-sdk/provider"),ve=require("lodash");var fe="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY",ke="open_in_device_browser";function De(){return j.StyleSheet.create({"magic-webview":{flex:1,backgroundColor:"transparent"},"webview-container":{flex:1,width:"100%",backgroundColor:"transparent",position:"absolute",top:0,left:0,right:0,bottom:0},show:{zIndex:1e4,elevation:1e4},hide:{zIndex:-1e4,elevation:0}})}var W=class extends B.ViewController{constructor(){super(...arguments);this.Relayer=()=>{let[i,p]=(0,w.useState)(!1),c=(0,w.useCallback)(S=>{this.webView=S},[]),L=(0,w.useCallback)(S=>{this.container=le(ce({},S),{showOverlay:h,hideOverlay:_})},[]),h=(0,w.useCallback)(()=>{p(!0)},[]),_=(0,w.useCallback)(()=>{p(!1)},[]),g=(0,w.useMemo)(()=>[this.styles["webview-container"],i?this.styles.show:this.styles.hide],[i]),v=(0,w.useCallback)(S=>{this.handleReactNativeWebViewMessage(S)},[]);return w.default.createElement(pe.SafeAreaView,{ref:L,style:g},w.default.createElement(he.WebView,{ref:c,source:{uri:`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`},onMessage:v,style:this.styles["magic-webview"],autoManageStatusBarEnabled:!1,onShouldStartLoadWithRequest:S=>new URLSearchParams(S.url.split("?")[1]).get(ke)?(j.Linking.openURL(S.url),!1):!0}))}}init(){this.webView=null,this.container=null,this.styles=De()}handleReactNativeWebViewMessage(i){var p;if(i.nativeEvent&&typeof i.nativeEvent.data=="string"&&(i.nativeEvent.url===`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`||i.nativeEvent.url===`${this.endpoint}/send/?params=${this.parameters}`)){let c=JSON.parse(i.nativeEvent.data,(L,h)=>{try{if(h&&typeof h=="object"&&h.flag&&h.flag===fe)return new global[h.constructor](h.data.split(","))}catch(_){}return h});if(c&&c.msgType&&this.messageHandlers.size){c.response=(p=c.response)!=null?p:{};let L={data:c};for(let h of this.messageHandlers.values())h(L)}}}hideOverlay(){this.container&&this.container.hideOverlay()}showOverlay(){this.container&&this.container.showOverlay()}_post(i){return C(this,null,function*(){if(this.webView&&this.webView.postMessage)this.webView.postMessage(JSON.stringify(i,(p,c)=>(0,ve.isTypedArray)(c)?{constructor:c.constructor.name,data:c.toString(),flag:fe}:c),this.endpoint);else throw(0,B.createModalNotReadyError)()})}};var me=require("@magic-sdk/provider"),U=class extends me.SDKBase{get Relayer(){return this.overlay.Relayer}};f(u,require("@magic-sdk/commons"),module.exports);global.process=ge.merge(global.process,Te);global.process.browser=!1;global.Buffer=$.Buffer;global.URL=Y.URL;global.URLSearchParams=Y.URLSearchParams;global.btoa=n=>$.Buffer.from(n,"binary").toString("base64");global.atob=n=>$.Buffer.from(n,"base64").toString("binary");var Ce=(0,de.createSDK)(U,{platform:"react-native",sdkName:"@magic-sdk/react-native-bare",version:"18.5.0",bundleId:(0,we.getBundleId)(),defaultEndpoint:"https://box.magic.link/",ViewController:W,configureStorage:()=>C(void 0,null,function*(){let n=ye.default.createInstance({name:"MagicAuthLocalStorageDB",storeName:"MagicAuthLocalStorage"}),a=(0,be.driverWithoutSerialization)();return yield Promise.all([n.defineDriver(a),n.defineDriver(ee)]),yield n.setDriver([a._driver,ee._driver]),n})});0&&(module.exports={Magic});
//# sourceMappingURL=index.js.map
