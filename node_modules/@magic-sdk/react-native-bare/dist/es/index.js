var ue=Object.create;var $=Object.defineProperty,fe=Object.defineProperties,he=Object.getOwnPropertyDescriptor,pe=Object.getOwnPropertyDescriptors,ve=Object.getOwnPropertyNames,X=Object.getOwnPropertySymbols,me=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty,de=Object.prototype.propertyIsEnumerable;var Z=(o,s,i)=>s in o?$(o,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[s]=i,te=(o,s)=>{for(var i in s||(s={}))ee.call(s,i)&&Z(o,i,s[i]);if(X)for(var i of X(s))de.call(s,i)&&Z(o,i,s[i]);return o},re=(o,s)=>fe(o,pe(s));var ye=(o,s)=>()=>(s||o((s={exports:{}}).exports,s),s.exports);var ge=(o,s,i,f)=>{if(s&&typeof s=="object"||typeof s=="function")for(let c of ve(s))!ee.call(o,c)&&c!==i&&$(o,c,{get:()=>s[c],enumerable:!(f=he(s,c))||f.enumerable});return o};var we=(o,s,i)=>(i=o!=null?ue(me(o)):{},ge(s||!o||!o.__esModule?$(i,"default",{value:o,enumerable:!0}):i,o));var I=(o,s,i)=>new Promise((f,c)=>{var b=d=>{try{S(i.next(d))}catch(h){c(h)}},u=d=>{try{S(i.throw(d))}catch(h){c(h)}},S=d=>d.done?f(d.value):Promise.resolve(d.value).then(b,u);S((i=i.apply(o,s)).next())});var ne=ye((Be,q)=>{var K=function(o){"use strict";var s=Object.prototype,i=s.hasOwnProperty,f=Object.defineProperty||function(t,e,r){t[e]=r.value},c,b=typeof Symbol=="function"?Symbol:{},u=b.iterator||"@@iterator",S=b.asyncIterator||"@@asyncIterator",d=b.toStringTag||"@@toStringTag";function h(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch{h=function(e,r,a){return e[r]=a}}function g(t,e,r,a){var n=e&&e.prototype instanceof T?e:T,l=Object.create(n.prototype),p=new B(a||[]);return f(l,"_invoke",{value:ce(t,r,p)}),l}o.wrap=g;function M(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(a){return{type:"throw",arg:a}}}var D="suspendedStart",se="suspendedYield",J="executing",V="completed",w={};function T(){}function A(){}function E(){}var C={};h(C,u,function(){return this});var W=Object.getPrototypeOf,N=W&&W(W(U([])));N&&N!==s&&i.call(N,u)&&(C=N);var _=E.prototype=T.prototype=Object.create(C);A.prototype=E,f(_,"constructor",{value:E,configurable:!0}),f(E,"constructor",{value:A,configurable:!0}),A.displayName=h(E,d,"GeneratorFunction");function H(t){["next","throw","return"].forEach(function(e){h(t,e,function(r){return this._invoke(e,r)})})}o.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===A||(e.displayName||e.name)==="GeneratorFunction":!1},o.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,h(t,d,"GeneratorFunction")),t.prototype=Object.create(_),t},o.awrap=function(t){return{__await:t}};function G(t,e){function r(l,p,v,y){var m=M(t[l],t,p);if(m.type==="throw")y(m.arg);else{var Y=m.arg,O=Y.value;return O&&typeof O=="object"&&i.call(O,"__await")?e.resolve(O.__await).then(function(L){r("next",L,v,y)},function(L){r("throw",L,v,y)}):e.resolve(O).then(function(L){Y.value=L,v(Y)},function(L){return r("throw",L,v,y)})}}var a;function n(l,p){function v(){return new e(function(y,m){r(l,p,y,m)})}return a=a?a.then(v,v):v()}f(this,"_invoke",{value:n})}H(G.prototype),h(G.prototype,S,function(){return this}),o.AsyncIterator=G,o.async=function(t,e,r,a,n){n===void 0&&(n=Promise);var l=new G(g(t,e,r,a),n);return o.isGeneratorFunction(e)?l:l.next().then(function(p){return p.done?p.value:l.next()})};function ce(t,e,r){var a=D;return function(l,p){if(a===J)throw new Error("Generator is already running");if(a===V){if(l==="throw")throw p;return Q()}for(r.method=l,r.arg=p;;){var v=r.delegate;if(v){var y=x(v,r);if(y){if(y===w)continue;return y}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(a===D)throw a=V,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);a=J;var m=M(t,e,r);if(m.type==="normal"){if(a=r.done?V:se,m.arg===w)continue;return{value:m.arg,done:r.done}}else m.type==="throw"&&(a=V,r.method="throw",r.arg=m.arg)}}}function x(t,e){var r=e.method,a=t.iterator[r];if(a===c)return e.delegate=null,r==="throw"&&t.iterator.return&&(e.method="return",e.arg=c,x(t,e),e.method==="throw")||r!=="return"&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+r+"' method")),w;var n=M(a,t.iterator,e.arg);if(n.type==="throw")return e.method="throw",e.arg=n.arg,e.delegate=null,w;var l=n.arg;if(!l)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,w;if(l.done)e[t.resultName]=l.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=c);else return l;return e.delegate=null,w}H(_),h(_,d,"Generator"),h(_,u,function(){return this}),h(_,"toString",function(){return"[object Generator]"});function le(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function B(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(le,this),this.reset(!0)}o.keys=function(t){var e=Object(t),r=[];for(var a in e)r.push(a);return r.reverse(),function n(){for(;r.length;){var l=r.pop();if(l in e)return n.value=l,n.done=!1,n}return n.done=!0,n}};function U(t){if(t){var e=t[u];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(i.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=c,n.done=!0,n};return a.next=a}}return{next:Q}}o.values=U;function Q(){return{value:c,done:!0}}return B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=c,this.done=!1,this.delegate=null,this.method="next",this.arg=c,this.tryEntries.forEach(j),!t)for(var e in this)e.charAt(0)==="t"&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=c)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(y,m){return l.type="throw",l.arg=t,e.next=y,m&&(e.method="next",e.arg=c),!!m}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],l=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var p=i.call(n,"catchLoc"),v=i.call(n,"finallyLoc");if(p&&v){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(p){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(v){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var l=n?n.completion:{};return l.type=t,l.arg=e,n?(this.method="next",this.next=n.finallyLoc,w):this.complete(l)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),w},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),j(r),w}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var a=r.completion;if(a.type==="throw"){var n=a.arg;j(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:U(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=c),w}},o}(typeof q=="object"?q.exports:{});try{regeneratorRuntime=K}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=K:Function("r","regeneratorRuntime = r")(K)}});var Qe=we(ne());import{createSDK as Ie}from"@magic-sdk/provider";import*as Pe from"process";import ke from"localforage";import{URL as De,URLSearchParams as Te}from"whatwg-url";import{Buffer as z}from"buffer";import*as ae from"lodash";import{getBundleId as Ce}from"react-native-device-info";import{driverWithoutSerialization as We}from"@aveq-research/localforage-asyncstorage-driver";import*as F from"localforage-driver-memory";import oe,{useState as be,useCallback as R,useMemo as Se}from"react";import{Linking as Ee,StyleSheet as Le}from"react-native";import{WebView as _e}from"react-native-webview";import{SafeAreaView as Oe}from"react-native-safe-area-context";import{ViewController as Re,createModalNotReadyError as Me}from"@magic-sdk/provider";import{isTypedArray as Ve}from"lodash";var ie="MAGIC_PAYLOAD_FLAG_TYPED_ARRAY",Ae="open_in_device_browser";function Ne(){return Le.create({"magic-webview":{flex:1,backgroundColor:"transparent"},"webview-container":{flex:1,width:"100%",backgroundColor:"transparent",position:"absolute",top:0,left:0,right:0,bottom:0},show:{zIndex:1e4,elevation:1e4},hide:{zIndex:-1e4,elevation:0}})}var P=class extends Re{constructor(){super(...arguments);this.Relayer=()=>{let[i,f]=be(!1),c=R(g=>{this.webView=g},[]),b=R(g=>{this.container=re(te({},g),{showOverlay:u,hideOverlay:S})},[]),u=R(()=>{f(!0)},[]),S=R(()=>{f(!1)},[]),d=Se(()=>[this.styles["webview-container"],i?this.styles.show:this.styles.hide],[i]),h=R(g=>{this.handleReactNativeWebViewMessage(g)},[]);return oe.createElement(Oe,{ref:b,style:d},oe.createElement(_e,{ref:c,source:{uri:`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`},onMessage:h,style:this.styles["magic-webview"],autoManageStatusBarEnabled:!1,onShouldStartLoadWithRequest:g=>new URLSearchParams(g.url.split("?")[1]).get(Ae)?(Ee.openURL(g.url),!1):!0}))}}init(){this.webView=null,this.container=null,this.styles=Ne()}handleReactNativeWebViewMessage(i){var f;if(i.nativeEvent&&typeof i.nativeEvent.data=="string"&&(i.nativeEvent.url===`${this.endpoint}/send/?params=${encodeURIComponent(this.parameters)}`||i.nativeEvent.url===`${this.endpoint}/send/?params=${this.parameters}`)){let c=JSON.parse(i.nativeEvent.data,(b,u)=>{try{if(u&&typeof u=="object"&&u.flag&&u.flag===ie)return new global[u.constructor](u.data.split(","))}catch(S){}return u});if(c&&c.msgType&&this.messageHandlers.size){c.response=(f=c.response)!=null?f:{};let b={data:c};for(let u of this.messageHandlers.values())u(b)}}}hideOverlay(){this.container&&this.container.hideOverlay()}showOverlay(){this.container&&this.container.showOverlay()}_post(i){return I(this,null,function*(){if(this.webView&&this.webView.postMessage)this.webView.postMessage(JSON.stringify(i,(f,c)=>Ve(c)?{constructor:c.constructor.name,data:c.toString(),flag:ie}:c),this.endpoint);else throw Me()})}};import{SDKBase as Ge}from"@magic-sdk/provider";var k=class extends Ge{get Relayer(){return this.overlay.Relayer}};export*from"@magic-sdk/commons";global.process=ae.merge(global.process,Pe);global.process.browser=!1;global.Buffer=z;global.URL=De;global.URLSearchParams=Te;global.btoa=o=>z.from(o,"binary").toString("base64");global.atob=o=>z.from(o,"base64").toString("binary");var ct=Ie(k,{platform:"react-native",sdkName:"@magic-sdk/react-native-bare",version:"18.5.0",bundleId:Ce(),defaultEndpoint:"https://box.magic.link/",ViewController:P,configureStorage:()=>I(void 0,null,function*(){let o=ke.createInstance({name:"MagicAuthLocalStorageDB",storeName:"MagicAuthLocalStorage"}),s=We();return yield Promise.all([o.defineDriver(s),o.defineDriver(F)]),yield o.setDriver([s._driver,F._driver]),o})});export{ct as Magic};
//# sourceMappingURL=index.js.map
